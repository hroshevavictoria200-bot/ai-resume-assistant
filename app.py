import streamlit as st
import google.generativeai as genai

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è API-–∫–ª—é—á–∞ –∑ Streamlit secrets
try:
    genai.configure(api_key=st.secrets["GOOGLE_API_KEY"])
except KeyError:
    st.error("–í—ñ–¥—Å—É—Ç–Ω—ñ–π –∫–ª—é—á Google Gemini API. –ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–¥–∞–π—Ç–µ –π–æ–≥–æ —É —Ñ–∞–π–ª secrets.toml.")
    st.stop()

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ
model = genai.GenerativeModel('gemini-pro')

st.set_page_config(page_title="AI –ê—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –í–∞–∫–∞–Ω—Å—ñ–π", layout="wide")

## –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (UI)
st.title("AI –ê—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –≤–∞–∫–∞–Ω—Å—ñ–π")
st.subheader("–ú–∏—Ç—Ç—î–≤–æ –æ–ø—Ç–∏–º—ñ–∑—É–π—Ç–µ —Å–≤–æ—î —Ä–µ–∑—é–º–µ –ø—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –≤–∞–∫–∞–Ω—Å—ñ—é.")

st.info("–í—Å—Ç–∞–≤—Ç–µ —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å—ñ—ó —Ç–∞ –≤–∞—à–µ —Ä–µ–∑—é–º–µ. AI –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É—î —ó—Ö —ñ –Ω–∞–¥–∞—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.")

job_posting = st.text_area("üìÑ **–í—Å—Ç–∞–≤—Ç–µ —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å—ñ—ó:**", height=250, help="–°–∫–æ–ø—ñ—é–π—Ç–µ –æ–ø–∏—Å –≤–∞–∫–∞–Ω—Å—ñ—ó –ø–æ–≤–Ω—ñ—Å—Ç—é.")
user_resume = st.text_area("üìù **–í—Å—Ç–∞–≤—Ç–µ –≤–∞—à–µ —Ä–µ–∑—é–º–µ:**", height=250, help="–°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–µ–∫—Å—Ç –≤–∞—à–æ–≥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä–µ–∑—é–º–µ.")

analyze_button = st.button("üöÄ –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞ –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Ä–µ–∑—é–º–µ")

## –õ–æ–≥—ñ–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—É
if analyze_button:
    if not job_posting or not user_resume:
        st.warning("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–∏–¥–≤–∞ –ø–æ–ª—è.")
    else:
        # –ü—Ä–æ–º–ø—Ç –¥–ª—è Google Gemini (–Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∞ —á–∞—Å—Ç–∏–Ω–∞!)
        prompt = f"""
        –¢–∏ ‚Äî AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç, —â–æ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –Ω–∞ –∞–Ω–∞–ª—ñ–∑—ñ –≤–∞–∫–∞–Ω—Å—ñ–π —Ç–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤—Ü—ñ —Ä–µ–∑—é–º–µ.
        –¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –Ω–∞–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Ç–∞ –∫–æ—Ä–∏—Å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑.

        **–ö—Ä–æ–∫ 1: –ê–Ω–∞–ª—ñ–∑ –í–∞–∫–∞–Ω—Å—ñ—ó**
        –í–∏–¥—ñ–ª–∏ –∫–ª—é—á–æ–≤—ñ –≤–∏–º–æ–≥–∏, –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –Ω–∞–≤–∏—á–∫–∏, –¥–æ—Å–≤—ñ–¥ —Ç–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó, –ø–µ—Ä–µ–ª—ñ—á–µ–Ω—ñ —É –≤–∞–∫–∞–Ω—Å—ñ—ó.

        **–ö—Ä–æ–∫ 2: –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –†–µ–∑—é–º–µ**
        –ü–æ—Ä—ñ–≤–Ω—è–π –Ω–∞–≤–∏—á–∫–∏ —Ç–∞ –¥–æ—Å–≤—ñ–¥, –∑–∞–∑–Ω–∞—á–µ–Ω—ñ —É –Ω–∞–¥–∞–Ω–æ–º—É —Ä–µ–∑—é–º–µ, –∑ –≤–∏–º–æ–≥–∞–º–∏ –≤–∞–∫–∞–Ω—Å—ñ—ó.

        **–ö—Ä–æ–∫ 3: –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π**
        –ù–∞ –æ—Å–Ω–æ–≤—ñ –∞–Ω–∞–ª—ñ–∑—É, —Å—Ç–≤–æ—Ä–∏ —Ç—Ä–∏ —Ä–æ–∑–¥—ñ–ª–∏:
        
        ### üü¢ –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –≤ —Ä–µ–∑—é–º–µ
        * –ü–µ—Ä–µ–ª—ñ—á–∏ –Ω–∞–≤–∏—á–∫–∏ —Ç–∞ –¥–æ—Å–≤—ñ–¥ —ñ–∑ —Ä–µ–∑—é–º–µ, —è–∫—ñ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑–±—ñ–≥–∞—é—Ç—å—Å—è –∑ –≤–∏–º–æ–≥–∞–º–∏ –≤–∞–∫–∞–Ω—Å—ñ—ó. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Å–ø–∏—Å–∫–∏.

        ### üî¥ –ü—Ä–æ–≥–∞–ª–∏–Ω–∏ –≤ –Ω–∞–≤–∏—á–∫–∞—Ö
        * –ü–µ—Ä–µ–ª—ñ—á–∏ –Ω–∞–≤–∏—á–∫–∏, —è–∫—ñ –≤–∫–∞–∑–∞–Ω—ñ —É –≤–∞–∫–∞–Ω—Å—ñ—ó, –∞–ª–µ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ —Ä–µ–∑—é–º–µ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Å–ø–∏—Å–∫–∏.

        ### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—é–º–µ
        * –ó–∞–ø—Ä–æ–ø–æ–Ω—É–π, —è–∫ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ –∞–±–æ –¥–æ–ø–æ–≤–Ω–∏—Ç–∏ —Ä–µ–∑—é–º–µ, —â–æ–± –≤–æ–Ω–æ –∫—Ä–∞—â–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–æ –≤–∞–∫–∞–Ω—Å—ñ—ó.
        * –í–∫–∞–∂–∏, —è–∫—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –∑ –≤–∞–∫–∞–Ω—Å—ñ—ó –≤–∞—Ä—Ç–æ –¥–æ–¥–∞—Ç–∏.
        * –ó–∞–ø—Ä–æ–ø–æ–Ω—É–π, —è–∫ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏ –¥–æ—Å–≤—ñ–¥, —â–æ–± –≤—ñ–Ω –∑–≤—É—á–∞–≤ –±—ñ–ª—å—à —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ.

        ---

        **–í–ê–ö–ê–ù–°–Ü–Ø:**
        {job_posting}

        **–†–ï–ó–Æ–ú–ï:**
        {user_resume}

        """

        # –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ AI —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        with st.spinner("üß† AI –∞–Ω–∞–ª—ñ–∑—É—î..."):
            try:
                response = model.generate_content(prompt)
                st.success("‚úÖ –ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
                st.markdown(response.text)
            except Exception as e:
                st.error(f"–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –¥–æ AI: {e}")